var TreemapCore=function(){function t(){}return t.prototype.sortData=function(t){return t.sort(function(t,e){return t.value===e.value?0:e.value-t.value})},t.prototype.tableDim=function(t,e,i,s){for(var r,n=1,h=0;h<t&&(n=h+1,!((r=n*e)>=t));h++);return{cols:n,rows:e,emptyCells:r-t,cellWidth:i/n,cellHeight:s/e}},t.prototype.getBestSample=function(t,e){var i=e.sort(function(t,e){return t.hwDiff-e.hwDiff});return i.splice(t,i.length),(i=i.sort(function(t,e){return t.emptyCells-e.emptyCells})).splice(0,1)},t.prototype.bufferize=function(t,e,i,s){for(var r,n,h=t,a=[],o=0;o<e.emptyCells;o++)h.push({label:"",color:"#D9D9D9",value:10});for(o=0;o<h.length;o++)r=Math.floor(o/e.cols),n=o%e.cols,a.push({entries:[h[o]],h:e.cellHeight,w:e.cellWidth,x:n*e.cellWidth,y:r*e.cellHeight,area:e.cellHeight*e.cellWidth});return a},t.prototype.partitionEqual=function(t,e,i){var s,r={entries:i,width:t,height:e,loop:!0},n={recentChange:0,currentChange:0},h={cols:0,rows:1,cellWidth:0,cellHeight:0,emptyCells:0,hwDiff:0},a=[];h.cellWidth=r.width/r.entries.length,h.cellHeight=r.height,n.currentChange=Math.abs(h.cellWidth-h.cellHeight),h.cols=r.entries.length,h.rows=1,h.emptyCells=0;for(var o=0;o<r.entries.length;o++){var l=this.tableDim(r.entries.length,o+1,r.width,r.height);h={cols:l.cols,rows:l.rows,emptyCells:l.emptyCells,cellWidth:l.cellWidth,cellHeight:l.cellHeight},n.recentChange=n.currentChange,n.currentChange=Math.abs(h.cellWidth-h.cellHeight),h.hwDiff=n.currentChange,a.push(h)}return s=this.getBestSample(5,a),this.bufferize(r.entries,s[0],t,e)},t.prototype.partition=function(t){var e,i,s={entries:null,x:t.x,y:t.y,w:null,h:null,area:null,total:null},r={entries:null,x:null,y:null,w:null,h:null,area:null,total:null};i=0;for(n=0;n<t.entries.length;n++)if((i+=t.entries[n].value)>t.total/2){e=n<=0?0:i-t.total/2>t.total/2-(i-t.entries[n].value)?n-1:n;break}i=0;for(var n=0;n<e+1;n++)i+=t.entries[n].value;return s.total=i,s.area=i/t.total*t.area,r.total=t.total-i,r.area=t.area-s.area,t.w>=t.h?(s.w=s.area/t.h,s.h=t.h,r.w=t.w-s.w,r.h=t.h,r.x=s.x+s.w,r.y=s.y):(s.w=t.w,s.h=s.area/t.w,r.w=t.w,r.h=t.h-s.h,r.x=s.x,r.y=s.y+s.h),s.entries=t.entries.splice(0,e+1),r.entries=t.entries,[s,r]},t.prototype.decompose=function(t,e,i,s){function r(){for(var t,e=!1,i=0;i<a.length;i++)if(a[i].entries.length>1){e=!0,t=i;break}return h=t,e}function n(t,e){var i,s;i=a[t],s=e.partition(i),a.push(s[0]),a.push(s[1]),a.splice(t,1)}var h,a=[],o=0,l=i,f=!1;if(s&&(f=s),f)a=this.partitionEqual(t,e,l);else{for(c=0;c<l.length;c++)l[c].value<=0&&l.splice(c,1);for(var c=0;c<l.length;c++)o+=l[c].value;for(a.push({entries:l,x:0,y:0,w:t,h:e,total:o,area:t*e});r();)n(h,this)}return a},t.prototype.generate=function(t,e,i,s){var r,n=!1;return s&&(n=s),r=s?i:this.sortData(i),this.decompose(t,e,r,n)},t}(),TreemapMain=function(){function t(){this.play=!1,this.tipsAlwaysVisible=!1,this.equalpartition=!0,this.core=null,this.mouse={click:{x:-5,y:-5},hover:{x:null,y:null}}}return t.prototype.updateBuffers=function(t,e,i){this.childBuffer=[],this.buffer=[],this.buffer=this.core.generate(t,e,i,this.equalpartition);for(var s=0;s<this.buffer.length;s++)if(this.buffer[s].entries[0].children)for(var r=this.core.generate(this.buffer[s].w,this.buffer[s].h,this.buffer[s].entries[0].children),n=this.buffer[s].x,h=this.buffer[s].y,a=0;a<r.length;a++)r[a].x+=n,r[a].y+=h,this.childBuffer.push(r[a])},t.prototype.setDrawboard=function(t,e,i,s){this.core=new TreemapCore,this.width=e,this.height=i,this.self=document.getElementById(t),this.canv=this.self.getContext("2d"),this.updateBuffers(e,i,s)},t.prototype.clear=function(){this.canv.clearRect(0,0,this.width,this.height)},t.prototype.drawParentRects=function(){for(var t=0;t<this.buffer.length;t++){var e=20;if(this.canv.beginPath(),this.canv.lineWidth=.25,this.canv.strokeStyle="white",this.canv.fillStyle=this.buffer[t].entries[0].color,this.canv.fillRect(this.buffer[t].x,this.buffer[t].y,this.buffer[t].w,this.buffer[t].h),this.canv.strokeRect(this.buffer[t].x,this.buffer[t].y,this.buffer[t].w,this.buffer[t].h),this.canv.stroke(),this.canv.fill(),this.canv.fillStyle="white",this.buffer[t].entries[0].label){this.canv.font="bold 14px arial";if((s=this.canv.measureText(this.buffer[t].entries[0].label)).width+15>this.buffer[t].w-15){e+=15*(r=this.wrapText(this.canv,this.buffer[t].entries[0].label,this.buffer[t].x+15,this.buffer[t].y+e,this.buffer[t].w-15,15))}else this.canv.fillText(this.buffer[t].entries[0].label,this.buffer[t].x+15,this.buffer[t].y+e);this.canv.fill(),e+=15}if(this.buffer[t].entries[0].captions)for(var i=0;i<this.buffer[t].entries[0].captions.length;i++){this.canv.fillStyle="white",this.canv.font="normal 11px arial";var s=this.canv.measureText(this.buffer[t].entries[0].captions[i]);if(s.width+15>this.buffer[t].w-15){var r=this.wrapText(this.canv,this.buffer[t].entries[0].captions[i],this.buffer[t].x+15,this.buffer[t].y+e,this.buffer[t].w-15,15);e+=15*r}else this.canv.fillText(this.buffer[t].entries[0].captions[i],this.buffer[t].x+15,this.buffer[t].y+e);this.canv.fill(),e+=15}this.canv.closePath()}},t.prototype.wrapText=function(t,e,i,s,r,n){for(var h,a,o=e.split(" "),l="",f=0,c=0;c<o.length;c++){for(h=o[c],a=t.measureText(h);a.width>r;)h=h.substring(0,h.length-1),a=t.measureText(h);o[c]!=h&&(o.splice(c+1,0,o[c].substr(h.length)),o[c]=h),h=l+o[c]+" ",(a=t.measureText(h)).width>r&&c>0?(t.fillText(l,i,s),l=o[c]+" ",s+=n,f++):l=h}return t.fillText(l,i,s),f},t.prototype.drawChildRects=function(){for(var t=0;t<this.childBuffer.length;t++)this.canv.beginPath(),this.canv.lineWidth=.25,this.canv.strokeStyle="white",this.canv.strokeRect(this.childBuffer[t].x,this.childBuffer[t].y,this.childBuffer[t].w,this.childBuffer[t].h),this.canv.stroke(),this.canv.closePath()},t.prototype.drawHover=function(t){try{this.canv.beginPath(),this.canv.fillStyle="rgba(0, 0, 0, 0.1)",this.canv.fillRect(this.buffer[t].x,this.buffer[t].y,this.buffer[t].w-1,this.buffer[t].h-1),this.canv.stroke(),this.canv.fill(),this.canv.closePath()}catch(t){}},t.prototype.drawClick=function(){var t=this.cursorOverThis(this.mouse.click.x,this.mouse.click.y);try{this.canv.beginPath(),this.canv.fillStyle="rgba(0, 0, 0, 0.2)",this.canv.fillRect(this.buffer[t].x,this.buffer[t].y,this.buffer[t].w,this.buffer[t].h),this.canv.stroke(),this.canv.fill(),this.canv.closePath()}catch(t){}},t.prototype.drawTips=function(){var t,e,i,s,r,n,h,a,o=!1,l=this.mouse.hover.x,f=this.mouse.hover.y,c=this.cursorOverThis(l,f),u=300,p=100,v=20,y=10,d="rgba(0, 0, 0, 0.4)",b=20,w=15,m="black",g=20;try{(this.buffer[c].w<100||this.buffer[c].h<50)&&(o=!0)}catch(t){}if(this.tipsAlwaysVisible||o){this.canv.fillStyle="rgba(255, 255, 255, 0.9)",function(o){l<o.width-v-u?(i=(t=l+v)+u,r=t+g,h=t+y):(r=(t=l-v)-g,h=(i=t-u)+y),f<o.height-v-p?(s=(e=f+v)+p,n=e+g,a=e+y+10):(n=(e=f-v)-g,a=(s=e-p)+y+10)}(this),function(h){h.canv.beginPath(),h.canv.shadowBlur=b,h.canv.shadowColor=d,h.canv.moveTo(r,e),h.canv.lineTo(i,e),h.canv.lineTo(i,s),h.canv.lineTo(t,s),h.canv.lineTo(t,n),h.canv.lineTo(l,f),h.canv.lineTo(r,e),h.canv.fill(),h.canv.closePath(),h.canv.shadowBlur=0}(this);try{!function(t,e){var i=a;e.canv.beginPath(),e.buffer[t].entries[0].label&&(e.canv.fillStyle=m,e.canv.font="bold 14px arial",(r=e.canv.measureText(e.buffer[t].entries[0].label)).width>290?i+=15*(n=e.wrapText(e.canv,e.buffer[t].entries[0].label,h,i,920,15)):e.canv.fillText(e.buffer[t].entries[0].label,h,i),e.canv.fill(),i+=w);if(e.buffer[t].entries[0].captions){e.canv.fillStyle=m;for(var s=0;s<e.buffer[t].entries[0].captions.length;s++){e.canv.font="normal 11px arial";var r=e.canv.measureText(e.buffer[t].entries[0].captions[s]);if(r.width>290){var n=e.wrapText(e.canv,e.buffer[t].entries[0].captions[s],h,i,290,15);i+=15*n}else e.canv.fillText(e.buffer[t].entries[0].captions[s],h,i);i+=w,e.canv.fill()}}e.canv.closePath()}(c,this)}catch(t){}}},t.prototype.cursorOverThis=function(t,e){for(var i,s=0;s<this.buffer.length;s++)if(this.buffer[s].x<=t&&t<=this.buffer[s].x+this.buffer[s].w&&this.buffer[s].y<=e&&e<=this.buffer[s].y+this.buffer[s].h){i=s;break}return i},t.prototype.render=function(){var t=this;setTimeout(function(){t.play&&(t.clear(),t.drawParentRects(),t.drawChildRects(),t.drawHover(t.cursorOverThis(t.mouse.hover.x,t.mouse.hover.y)),t.drawClick(),t.drawTips(),t.render())},20)},t.prototype.setPlay=function(t){this.play=t,this.render()},t.prototype.tipAlwaysVisible=function(t){this.tipsAlwaysVisible=t},t.prototype.setClickPos=function(t,e){this.mouse.click.x=t,this.mouse.click.y=e},t.prototype.setHoverPos=function(t,e){this.mouse.hover.x=t,this.mouse.hover.y=e},t.prototype.draw=function(){this.drawParentRects(),this.drawChildRects()},t.prototype.getCLickIndex=function(){return this.cursorOverThis(this.mouse.hover.x,this.mouse.hover.y)},t.prototype.getClickedItem=function(){for(var t={parents:null,selected:null},e=[],i=0;i<this.buffer.length;i++)e.push(this.buffer[i].entries[0]);return t.parents=e,t.selected=this.buffer[this.cursorOverThis(this.mouse.hover.x,this.mouse.hover.y)].entries[0],t},t.prototype.getBuffers=function(){return{parent:this.buffer,child:this.childBuffer}},t.prototype.updateData=function(t,e){this.mouse.click.x=-5,this.mouse.click.y=-5,this.equalpartition=e,this.updateBuffers(this.width,this.height,t),this.drawParentRects(),this.drawChildRects()},t.prototype.init=function(t,e,i,s,r){this.equalpartition=r,this.setDrawboard(t,e,i,s),this.draw()},t}(),TreemapTransition=function(){function t(){this.transitionTime=2e3,this.renderTime=16,this.effects="fade",this.effectsDir="out",this.play=!1,this.origin=null,this.centerIndex=null,this.originItem=null,this.speed=15,this.mouse={click:{x:null,y:null}},this.animation={fade:function(t){}},this.core=null}return t.prototype.setStyle=function(t){t.style.opacity="0"},t.prototype.setDrawboard=function(t,e,i){this.core=new TreemapCore,this.width=e,this.height=i,this.self=document.getElementById(t),this.canv=this.self.getContext("2d"),this.setStyle(this.self)},t.prototype.drawParentRects=function(){for(var t=0;t<this.buffer.length;t++){var e=20;if(this.canv.beginPath(),this.canv.lineWidth=.25,this.canv.strokeStyle="white",this.canv.fillStyle=this.buffer[t].entries[0].color,this.canv.fillRect(this.buffer[t].x,this.buffer[t].y,this.buffer[t].w,this.buffer[t].h),this.canv.strokeRect(this.buffer[t].x,this.buffer[t].y,this.buffer[t].w,this.buffer[t].h),this.canv.stroke(),this.canv.fill(),this.buffer[t].entries[0].label&&(this.canv.fillStyle="white",this.canv.font="bold 14px arial",this.canv.fillText(this.buffer[t].entries[0].label,this.buffer[t].x+15,this.buffer[t].y+e),this.canv.fill(),e+=15),this.buffer[t].entries[0].captions)for(var i=0;i<this.buffer[t].entries[0].captions.length;i++)this.canv.fillStyle="white",this.canv.font="normal 11px arial",this.canv.fillText(this.buffer[t].entries[0].captions[i],this.buffer[t].x+15,this.buffer[t].y+e),this.canv.fill(),e+=15;this.canv.closePath()}},t.prototype.drawChildRects=function(){for(var t=0;t<this.childBuffer.length;t++)this.canv.beginPath(),this.canv.lineWidth=.25,this.canv.strokeStyle="white",this.canv.strokeRect(this.childBuffer[t].x,this.childBuffer[t].y,this.childBuffer[t].w,this.childBuffer[t].h),this.canv.stroke(),this.canv.closePath()},t.prototype.clear=function(){this.canv.clearRect(0,0,this.width,this.height)},t.prototype.animate=function(){"fade"===this.effects&&this.animation.fade(this.effectsDir)},t.prototype.preAnimate=function(){var t=this;this.self.style.opacity=1,this.play=!0,"fade"===this.effects&&(setTimeout(function(){t.stop()},150),"in"===this.effectsDir&&(this.self.style.opacity=1),"out"===this.effectsDir&&(this.self.style.opacity=1))},t.prototype.render=function(){var t=this;setTimeout(function(){t.play&&(t.clear(),t.drawParentRects(),t.drawChildRects(),t.animate(),t.render())},this.renderTime)},t.prototype.start=function(){this.drawParentRects(),this.drawChildRects(),this.self.style.transition="opacity 0s",this.preAnimate(),this.render()},t.prototype.stop=function(){this.self.style.transition="opacity .5s",this.self.style.opacity=0,this.play=!1},t.prototype.setPlay=function(t){this.play=t,this.render()},t.prototype.setEffect=function(t,e){this.effects=t,this.effectsDir=e},t.prototype.draw=function(){this.drawParentRects()},t.prototype.updateData=function(t){this.updateBuffers(t),this.drawParentRects(),this.drawChildRects()},t.prototype.updateBuffers=function(t){this.buffer=t.parent,this.childBuffer=t.child},t.prototype.init=function(t,e,i){this.setDrawboard(t,e,i)},t}(),Treemap=function(){function t(){this.container={self:self,width:null,height:null,id:{self:null,main:null,transition:null,tips:null},data:null},this.offset={class:"treemap-offset",x:0,y:0},this.mouse={enable:!0,click:{x:null,y:null},hover:{x:null,y:null}},this.main=new TreemapMain,this.transition=new TreemapTransition}return t.prototype.setDrawboard=function(t,e,i){var s=i+Math.ceil(1e6*Math.random()),r=i+Math.ceil(1e6*Math.random()),n=document.createElement("canvas"),h=document.createElement("canvas");n.setAttribute("id",s),n.setAttribute("width",t),n.setAttribute("height",e),n.setAttribute("style","position:absolute;"),h.setAttribute("id",r),h.setAttribute("width",t),h.setAttribute("height",e),h.setAttribute("style","position:absolute;"),this.container.self=document.getElementById(i),this.container.self.appendChild(n),this.container.self.appendChild(h),this.container.id.main=s,this.container.id.transition=r},t.prototype.setStyle=function(t){t.style.cursor="pointer",t.style.position="relative"},t.prototype.setEvents=function(t,e,i){var s=this;t.addEventListener("click",function(t){s.mouse.enable&&(s.mouse.click.x=t.clientX-s.offset.x,s.mouse.click.y=t.clientY-s.offset.y,e.setClickPos(s.mouse.click.x,s.mouse.click.y))}),t.addEventListener("mousemove",function(t){s.mouse.enable&&(s.mouse.hover.x=t.clientX-s.offset.x,s.mouse.hover.y=t.clientY-s.offset.y,e.setHoverPos(s.mouse.hover.x,s.mouse.hover.y))}),t.addEventListener("mouseover",function(){s.mouse.enable&&(e.setPlay(!0),e.setClickPos(-5,-5))}),t.addEventListener("mouseout",function(){s.mouse.enable&&(e.setPlay(!1),e.draw())}),window.onresize=function(){s.setOffset()},window.onscroll=function(){s.setOffset()}},t.prototype.setOffset=function(){var t=0,e=0,i=[];try{i=document.getElementsByClassName(this.offset.class)}catch(t){}if(i)for(var s=0;s<i.length;s++)t+=i[s].offsetLeft,e+=i[s].offsetTop;this.offset.x=t-window.pageXOffset,this.offset.y=e-window.pageYOffset},t.prototype.changeData=function(t,e){var i=this;this.mouse.enable=!1,setTimeout(function(){i.mouse.enable=!0},100),this.transition.updateBuffers(this.main.getBuffers()),this.transition.start(),setTimeout(this.main.updateData(t,e),100)},t.prototype.getClickIndex=function(){return this.main.getCLickIndex()},t.prototype.setOffsetClass=function(t){this.offset.class=t},t.prototype.init=function(t,e,i,s,r){this.container.width=e,this.container.height=i,this.container.id.self=t,this.container.data=s,this.setDrawboard(e,i,t),this.setStyle(this.container.self),this.main.init(this.container.id.main,e,i,s,r),this.transition.init(this.container.id.transition,e,i),this.setEvents(this.container.self,this.main,this.transition),this.setOffset()},t}();